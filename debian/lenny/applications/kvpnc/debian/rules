#!/usr/bin/make -f

include /usr/share/cdbs/1/rules/debhelper.mk
include /usr/share/cdbs/1/class/kde.mk
include /usr/share/cdbs/1/rules/patchsys-quilt.mk
include /usr/share/cdbs/1/rules/utils.mk

DEB_CONFIGURE_SCRIPT_ENV += LDFLAGS="-Wl,--as-needed"
DEB_INSTALL_MANPAGES_kvpnc-trinity := debian/kvpnc-trinity.1

makebuilddir/kvpnc-trinity::
	make -f Makefile.cvs

install/kvpnc-trinity::
	# fix script-not-executable
	chmod 0755 debian/kvpnc-trinity/opt/trinity/share/apps/kvpnc/ping_check.sh

	# remove uneeded dir
	rm -rf debian/kvpnc-trinity/opt/trinity/share/doc/kde/HTML/kvpnc

	# install desktop file in applications
	install -D -p -m0644 src/kvpnc.desktop \
	  debian/kvpnc-trinity/opt/trinity/share/applications/kde/kvpnc.desktop

binary-post-install/kvpnc-trinity::
	rm -rf debian/kvpnc-trinity/opt/trinity/share/applnk/

clean::
	rm -f config.status config.log
	find . -type f -name '*.gmo' | xargs rm -f
