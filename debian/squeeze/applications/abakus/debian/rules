#!/usr/bin/make -f

include /usr/share/cdbs/1/rules/debhelper.mk
include /usr/share/cdbs/1/class/langcore.mk

DEB_CONFIGURE_INCLUDEDIR := /opt/trinity/include/kde
DEB_CONFIGURE_MANDIR := /opt/trinity/share/man
DEB_CONFIGURE_PREFIX := /opt/trinity
DEB_CONFIGURE_INFODIR := /opt/trinity/share/info

cdbs_configure_flags := --with-qt-dir=/usr/share/qt3 --disable-rpath --with-xinerama $(cdbs_kde_enable_final) $(cdbs_kde_enable_debug)

SCONS = scons --no-cache -Q
DEB_INSTALL_DOCS_ALL =
DEB_COMPRESS_EXCLUDE = .docbook

debian/abakus.xpm: src/hi64-app-abakus.png
	convert -resize 32 $< $@

common-build-arch:: build-stamp
build-stamp: debian/abakus.xpm 
	env PATH=/opt/trinity/bin:$(PATH) QTDIR=/usr/share/qt3 CMAKE_LIBRARY_PATH=/opt/trinity/lib CMAKE_INCLUDE_PATH=/opt/trinity/include/kde DESTDIR=$(DEB_DESTDIR)/opt/trinity $(SCONS) configure prefix=/opt/trinity
	env PATH=/opt/trinity/bin:$(PATH) QTDIR=/usr/share/qt3 CMAKE_LIBRARY_PATH=/opt/trinity/lib CMAKE_INCLUDE_PATH=/opt/trinity/include/kde DESTDIR=$(DEB_DESTDIR)/opt/trinity $(SCONS)
	touch build-stamp

common-install-arch::
	env PATH=/opt/trinity/bin:$(PATH) QTDIR=/usr/share/qt3 CMAKE_LIBRARY_PATH=/opt/trinity/lib CMAKE_INCLUDE_PATH=/opt/trinity/include/kde DESTDIR=$(DEB_DESTDIR)/opt/trinity $(SCONS) install
	install -D -m 644 debian/abakus.xpm debian/abakus-trinity/opt/trinity/share/pixmaps/abakus.xpm
	chrpath -d debian/abakus-trinity/opt/trinity/bin/abakus
	dh_icons -pabakus

clean::
	#env PATH=/opt/trinity/bin:$(PATH) QTDIR=/usr/share/qt3 CMAKE_LIBRARY_PATH=/opt/trinity/lib CMAKE_INCLUDE_PATH=/opt/trinity/include/kde DESTDIR=$(DEB_DESTDIR)/opt/trinity $(SCONS) --clean
	rm -f debian/abakus.xpm
	rm -rf cache
	rm -rf .sconf_temp
	rm -f bksys/generic.pyc
	rm -f bksys/abakus.pyc
	rm -f bksys/help.pyc
	rm -f bksys/kde.pyc
	rm -f config.log
